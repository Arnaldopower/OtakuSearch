{% load static %}
{% include "base.html" with include_header=True %}
<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="{% static 'css/anime-manga.css' %}">
</head>
<body>

    <div style="background-color: #f4effe;">
        <div class="animeInfo">
            <button class="exampleFilter"></button>
            <div class="headerDistance">
                <div class="animeInfo">
                    <div class="animeInfo">
                        <div class="detailsSpace">
                            <img id="animeImage"></img>
                        </div>
                        <div class="details">
                            <p class="scoreBox textTitleScore" id="animeScore"></p>
                            <div class="textDetailed">
                                <p id="animeRating"></p>
                                <p id="animeStatus"></p>
                                <p id="animeStudio"></p>
                                <p id="animeSource"></p>
                                <p id="animeGenre"></p>
                            </div>
                        </div>
                    </div>
                    <iframe id="animeVideo" class="avideo" width="420" height="315"></iframe>
                </div>

                <h1 id="animeTitle" class="textTitleScore" style="font-size: 35px;"></h1>
                <p id="animeSynopsis" class="textDetailed"></p>
            </div>
        </div>
    </div>

    <script>
        let embedUrl, embedImg, title, score, synopsis, rating, status, studio, source, genres

        function getAnime(idAnime){ 
            fetch('https://api.jikan.moe/v4/anime/'+ idAnime)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Error connecting")
                    }
                    return response.json()
                })
                .then (data => {
                    console.log(data)
                    
                    title = data["data"]['title']
                    embedImg = data["data"]["images"]["jpg"]["image_url"]
                    embedUrl = data["data"]["trailer"]["embed_url"]
                    score = data["data"]["score"] ? data["data"]["score"] : "No score for now"
                    synopsis = data["data"]["synopsis"] 
                    rating = data["data"]["rating"]
                    status = data["data"]["status"]
                    studio = data["data"]["studios"].length ? data["data"]["studios"][0]["name"] : "No studio working on it for now"
                    source = data["data"]["source"]
                    genres = data["data"]["genres"]


                    renderText(title, document.getElementById('animeTitle'))
                    renderImage(embedImg, document.getElementById('animeImage'))
                    renderVideo(embedUrl, document.getElementById('animeVideo'))
                    renderText(score, document.getElementById('animeScore'))
                    renderText(synopsis, document.getElementById('animeSynopsis'))
                    renderText("Rating: " + rating, document.getElementById('animeRating'))
                    renderText("Status: " + status, document.getElementById('animeStatus'))
                    renderText("Studio: " + studio, document.getElementById('animeStudio'))
                    renderText("Source: " + source, document.getElementById('animeSource'))
                    genres.forEach(element => {
                        renderText(element["name"]+"-", document.getElementById('animeGenre'))
                    });
                })
                .catch (error => (console.log("Error obtaining elements", error)))
        }

        function getManga(idManga){ 
            fetch('https://api.jikan.moe/v4/manga/'+ idManga)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Error connecting")
                    }
                    return response.json()
                })
                .then (data => {
                    console.log(data)
                    
                    title = data["data"]['title']
                    embedImg = data["data"]["images"]["jpg"]["image_url"]
                    embedUrl = null
                    score = data["data"]["score"] ? data["data"]["score"] : "No score for now"
                    synopsis = data["data"]["synopsis"] 
                    rating = data["data"]["authors"]
                    status = data["data"]["status"]
                    studio = data["data"]["serializations"].length ? data["data"]["serializations"][0]["name"] : "No serialization for now"
                    source = data["data"]["chapters"]
                    genres = data["data"]["genres"]


                    renderText(title, document.getElementById('animeTitle'))
                    renderImage(embedImg, document.getElementById('animeImage'))
                    renderVideo(embedUrl, document.getElementById('animeVideo'))
                    renderText(score, document.getElementById('animeScore'))
                    renderText(synopsis, document.getElementById('animeSynopsis'))
                    rating.forEach(element => {
                        renderText(element["name"]+"-", document.getElementById('animeRating'))
                    });
                    renderText("Status: " + status, document.getElementById('animeStatus'))
                    renderText("Serialization: " + studio, document.getElementById('animeStudio'))
                    renderText("Chapters: " + source, document.getElementById('animeSource'))
                    genres.forEach(element => {
                        renderText(element["name"]+"-", document.getElementById('animeGenre'))
                    });
                })
                .catch (error => (console.log("Error obtaining elements", error)))
        }

        function renderVideo(embedUrl, iframe) {
            if (embedUrl){
                iframe.src = embedUrl
            } else {
                iframe.style.display = "none"
            }
        }

        function renderImage(embedImg, img) {
            img.src = embedImg
        }

        function renderText(title, p){
            p.innerText += title
        }

        getAnime({{anime.id_anime}})
    </script>

</body>